<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation - Sonorium</title>
    <meta name="description" content="Sonorium documentation - complete guide to features and configuration.">
    <link rel="icon" type="image/png" href="images/icon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav>
        <div class="nav-container">
            <a href="index.html" class="nav-logo"><img src="images/logo.png" alt="Sonorium"></a>
            <div class="nav-links">
                <a href="index.html#downloads">Downloads</a>
                <a href="getting-started.html">Get Started</a>
                <a href="index.html#features">Features</a>
                <a href="faq.html">FAQ</a>
                <a href="docs.html">Docs</a>
                <a href="https://github.com/synssins/sonorium" target="_blank" class="btn btn-primary">
                    <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                    GitHub
                </a>
            </div>
            <button class="mobile-menu-btn" onclick="document.querySelector('.nav-links').classList.toggle('show')">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
            </button>
        </div>
    </nav>

    <div style="padding-top: 80px;">
        <div class="docs-layout">
            <aside class="docs-sidebar">
                <h3>Getting Started</h3>
                <ul>
                    <li><a href="getting-started.html">Installation</a></li>
                    <li><a href="#" onclick="loadPage('Home'); return false;" class="active">Overview</a></li>
                </ul>
                
                <h3>Features</h3>
                <ul>
                    <li><a href="#" onclick="loadPage('Channels'); return false;">Channels</a></li>
                    <li><a href="#" onclick="loadPage('Themes'); return false;">Themes</a></li>
                    <li><a href="#" onclick="loadPage('Track-Mixer'); return false;">Track Mixer</a></li>
                    <li><a href="#" onclick="loadPage('Presets'); return false;">Presets</a></li>
                    <li><a href="#" onclick="loadPage('Speakers'); return false;">Speakers</a></li>
                </ul>
                
                <h3>Advanced</h3>
                <ul>
                    <li><a href="#" onclick="loadPage('Configuration'); return false;">Configuration</a></li>
                    <li><a href="#" onclick="loadPage('API'); return false;">API Reference</a></li>
                </ul>
                
                <h3>Help</h3>
                <ul>
                    <li><a href="faq.html">FAQ</a></li>
                    <li><a href="#" onclick="loadPage('Troubleshooting'); return false;">Troubleshooting</a></li>
                </ul>

                <div class="docs-wiki-link">
                    <p>Docs loaded from <a href="https://github.com/synssins/sonorium/wiki" target="_blank">GitHub Wiki</a></p>
                </div>
            </aside>

            <main class="docs-content" id="docs-content">
                <div class="loading">Loading...</div>
            </main>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-logo"><img src="images/icon.png" alt="Sonorium"><span>Sonorium</span></div>
            <div class="footer-links">
                <a href="https://github.com/synssins/sonorium" target="_blank">GitHub</a>
                <a href="https://github.com/synssins/sonorium/wiki" target="_blank">Wiki</a>
                <a href="faq.html">FAQ</a>
            </div>
            <div class="footer-credit">Fork of <a href="https://github.com/fmtr/amniotic" target="_blank">Amniotic</a> by fmtr</div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        const defaultContent = {
            'Home': `# Sonorium Documentation

Welcome to the Sonorium documentation. Sonorium is a multi-zone ambient soundscape mixer.

## Quick Links

- [Getting Started](getting-started.html) — Installation guide
- [FAQ](faq.html) — Common questions
- [GitHub](https://github.com/synssins/sonorium) — Source code

## Features Overview

### Multi-Channel Audio
Run up to 10 independent channels. Each plays a different theme to different speakers.

### Theme-Based Mixing
Audio files in a theme blend together automatically with seamless crossfading.

### Track Mixer
Fine-tune volume, presence, and playback mode for each track.

### Presets
Save track configurations for quick recall.

### Export & Import
Share themes as zip files with the community.

## Platforms

**Available Now:**
- Home Assistant Addon (full network streaming)
- Windows App (local audio, network streaming coming soon)

**Coming Soon:**
- macOS App
- Linux App
- Docker Container

All standalone versions will support Chromecast, DLNA, and AirPlay streaming.`,

            'Channels': `# Channels

Channels are independent audio streams. Each channel plays one theme to one or more speakers.

## Creating a Channel

1. Go to **Channels**
2. Click **New Channel**
3. Name your channel
4. Select a theme
5. Choose speakers
6. Click **Play**

## Channel Controls

- **Theme** — The soundscape to play
- **Preset** — Quick-select saved track settings
- **Speakers** — Target speakers
- **Volume** — Channel volume (0-100%)

## Broadcast Model

All speakers on a channel hear the exact same stream—like tuning into a radio station. Speakers join mid-stream rather than starting from the beginning.

## Live Management

Add or remove speakers from a playing channel without stopping playback. Changes apply instantly.`,

            'Themes': `# Themes

Themes are collections of audio files that blend together to create a soundscape.

## Creating Themes

Open Sonorium, go to **Themes**, and click **Create Theme**. Give it a name, then drag and drop audio files to upload.

## Theme Features

- **Favorites** — Star themes for quick access
- **Categories** — Organize into groups
- **Icons** — Visual identification
- **Metadata** — Description, author, version

## Export & Import

**Export:** Click the export button to download a theme as a zip file with all audio and settings.

**Import:** Drag a theme zip file onto the Themes page or use the import button.

## Included Themes

Two starter themes are included:
- **Sleigh Ride** — Winter ambience with sleigh bells and snow
- **Tavern** — Medieval inn with fireplace and pub sounds`,

            'Track-Mixer': `# Track Mixer

The Track Mixer lets you fine-tune how individual audio files play within a theme.

## Controls

### Volume
Adjust amplitude of each track (0-100%).

### Presence
How often the track appears in the mix:
- **100%** — Always playing
- **50%** — Fades in and out
- **20%** — Occasional appearances

Great for occasional sounds like thunder or birds.

### Playback Mode
- **Auto** — Best mode based on file length
- **Continuous** — Loop with crossfade
- **Sparse** — Play once, wait, repeat
- **Gapless** — Loop without crossfade
- **Presence** — Fade based on presence

### Enable/Disable
Toggle tracks on or off without removing them.`,

            'Presets': `# Presets

Presets save your track mixer settings for quick recall.

## Creating Presets

1. Configure the track mixer
2. Click **Save Preset**
3. Name your preset

## Using Presets

Select a preset from:
- The channel card dropdown
- The preset selector in track mixer

## What's Saved

- Track volumes
- Presence settings
- Playback modes
- Enabled/disabled states

## Sharing

Export presets as JSON to share. Import with one click.

## Default Preset

Set a preset as default to auto-load when the theme is selected.`,

            'Speakers': `# Speakers

Sonorium discovers speakers from Home Assistant's media_player entities.

## Compatibility

Speakers must support HTTP audio streaming:
- **Sonos** — Full support
- **Google/Chromecast** — Works great
- **Amazon Echo** — Requires extra setup
- **DLNA/UPnP** — Most network speakers
- **AirPlay** — Works with AirPlay devices

## Speaker Settings

Go to **Settings → Speakers** to:
- Enable/disable speakers for Sonorium
- Refresh the speaker list
- View speaker details

## Speaker Groups

Create groups to target multiple speakers easily. Groups can span floors and areas.

## Troubleshooting

If speakers don't appear:
1. Verify they're media_player entities in HA
2. Check they're not disabled in Settings
3. Click Refresh Speakers`,

            'Configuration': `# Configuration

## Addon Settings

Configure in Home Assistant: **Settings → Add-ons → Sonorium → Configuration**

| Setting | Default | Description |
|---------|---------|-------------|
| stream_url | http://homeassistant.local:8008 | Base URL for streams |
| path_audio | /media/sonorium | Audio folder path |
| max_channels | 6 | Max concurrent channels (1-10) |

## App Settings

In Sonorium, go to **Settings** to configure:

- **Crossfade Duration** — Blend time between loops (0-10s)
- **Default Volume** — Initial volume for new channels
- **Master Gain** — Global output level
- **Short File Threshold** — Files shorter than this use sparse mode`,

            'API': `# API Reference

Sonorium provides a REST API for automation.

## Streams

\`\`\`
GET /stream/{theme_id}     # Direct theme stream
GET /stream/channel{n}     # Channel N stream
\`\`\`

## Channels

\`\`\`
GET  /api/channels              # List channels
POST /api/sessions              # Create channel
POST /api/sessions/{id}/play    # Start playback
POST /api/sessions/{id}/stop    # Stop playback
POST /api/sessions/{id}/volume  # Set volume
\`\`\`

## Themes

\`\`\`
GET  /api/themes              # List themes
POST /api/themes/create       # Create theme
POST /api/themes/{id}/upload  # Upload audio
\`\`\`

## Status

\`\`\`
GET /api/status    # System status
\`\`\``,

            'Troubleshooting': `# Troubleshooting

## No Sound

1. **Check speaker compatibility** — Must support HTTP streams
2. **Verify network** — Speaker must reach stream URL
3. **Check volumes** — Channel, master, and speaker volume
4. **Try another speaker** — Isolate the issue
5. **Check logs** — Look for errors in addon logs

## Speakers Not Found

1. Verify speakers are media_player entities in HA
2. Check they're not disabled in Sonorium Settings
3. Click Refresh Speakers
4. Restart the addon

## Audio Glitches

- Network congestion can cause dropouts
- Try lower bitrate audio files
- Check Home Assistant server load

## Theme Not Loading

- Verify audio files are supported formats
- Check for errors in logs
- Try re-uploading files

## Getting Help

- [FAQ](faq.html)
- [GitHub Issues](https://github.com/synssins/sonorium/issues)
- [GitHub Discussions](https://github.com/synssins/sonorium/discussions)`
        };

        function renderMarkdown(text) {
            if (typeof marked !== 'undefined' && marked.parse) {
                return marked.parse(text);
            }
            // Fallback: basic markdown rendering
            return text
                .replace(/^### (.+)$/gm, '<h3>$1</h3>')
                .replace(/^## (.+)$/gm, '<h2>$1</h2>')
                .replace(/^# (.+)$/gm, '<h1>$1</h1>')
                .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.+?)\*/g, '<em>$1</em>')
                .replace(/`([^`]+)`/g, '<code>$1</code>')
                .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2">$1</a>')
                .replace(/^- (.+)$/gm, '<li>$1</li>')
                .replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>')
                .replace(/\n\n/g, '</p><p>')
                .replace(/^(.+)$/gm, '<p>$1</p>')
                .replace(/<p><h/g, '<h')
                .replace(/<\/h(\d)><\/p>/g, '</h$1>')
                .replace(/<p><ul>/g, '<ul>')
                .replace(/<\/ul><\/p>/g, '</ul>')
                .replace(/<p><\/p>/g, '');
        }

        async function loadPage(pageName, clickedElement) {
            const content = document.getElementById('docs-content');
            content.innerHTML = '<div class="loading">Loading...</div>';
            
            // Update active state
            document.querySelectorAll('.docs-sidebar a').forEach(a => a.classList.remove('active'));
            if (clickedElement) {
                clickedElement.classList.add('active');
            } else if (event && event.target && event.target.tagName === 'A') {
                event.target.classList.add('active');
            }

            // Try GitHub wiki first, then use default content
            try {
                const response = await fetch(`https://raw.githubusercontent.com/wiki/synssins/sonorium/${pageName}.md`);
                
                if (response.ok) {
                    const markdown = await response.text();
                    content.innerHTML = renderMarkdown(markdown);
                } else if (defaultContent[pageName]) {
                    content.innerHTML = renderMarkdown(defaultContent[pageName]);
                } else {
                    content.innerHTML = `<h1>${pageName.replace(/-/g, ' ')}</h1><p>Page not found. Check the <a href="https://github.com/synssins/sonorium/wiki" target="_blank">GitHub Wiki</a>.</p>`;
                }
            } catch (e) {
                if (defaultContent[pageName]) {
                    content.innerHTML = renderMarkdown(defaultContent[pageName]);
                } else {
                    content.innerHTML = `<h1>${pageName.replace(/-/g, ' ')}</h1><p>Could not load. Check the <a href="https://github.com/synssins/sonorium/wiki" target="_blank">GitHub Wiki</a>.</p>`;
                }
            }
            window.scrollTo(0, 0);
        }

        // Initialize - wait for everything to load
        window.addEventListener('load', function() {
            const hash = window.location.hash.slice(1) || 'Home';
            const activeLink = document.querySelector('.docs-sidebar a.active');
            loadPage(hash, activeLink);
        });
    </script>
</body>
</html>